<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸ’¼ Mis Finanzas 2.0</title>
  <meta name="description" content="Control simple de gastos con login Firebase" />
  <style>
    :root{
      --bg:#0f172a; --panel:#ffffff; --accent:#38bdf8; --danger:#ef4444; --ok:#10b981;
      --text:#0f172a; --muted:#6b7280; --soft:#eef2f7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--soft);color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .card{background:var(--panel);border-radius:18px;box-shadow:0 10px 30px rgba(2,6,23,.08);padding:20px}
    .title{display:flex;gap:12px;align-items:center;margin:0 0 16px}
    .title .logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#0ea5e9)}
    .muted{color:var(--muted)}
    .row{display:flex;gap:16px;flex-wrap:wrap}
    .col{flex:1 1 280px}
    input,button,select{font:inherit}
    input,select{width:100%;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#fff}
    button{padding:10px 14px;border:0;border-radius:12px;cursor:pointer}
    .btn{background:var(--accent);color:white}
    .btn.secondary{background:#1118270f;color:#111827;border:1px solid #e5e7eb}
    .btn.danger{background:var(--danger);color:#fff}
    .grid{display:grid;gap:12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 8px;border-bottom:1px solid #f1f5f9;text-align:left}
    th{font-weight:600}
    .pill{padding:4px 10px;border-radius:999px;font-size:.85rem}
    .pill.ok{background:#ecfdf5;color:#065f46}
    .pill.bad{background:#fef2f2;color:#991b1b}
    .right{display:flex;gap:8px;align-items:center;margin-left:auto}
    .topbar{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .hidden{display:none !important}
    footer{margin:24px 0;color:var(--muted);font-size:.9rem;text-align:center}
    .authbox{max-width:460px;margin:40px auto}
    .hint{font-size:.9rem;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- AUTH -->
    <section id="auth" class="authbox">
      <div class="card grid">
        <h1 class="title"><span class="logo"></span> <span>IngresÃ¡ a <strong>Mis Finanzas 2.0</strong></span></h1>
        <p class="muted">Inicia sesiÃ³n o crea tu cuenta para usar tu tablero de gastos.</p>
        <label>Email
          <input id="email" type="email" placeholder="tu@email.com" autocomplete="email" />
        </label>
        <label>ContraseÃ±a
          <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
        </label>
        <div class="row">
          <button id="btnLogin" class="btn">Iniciar sesiÃ³n</button>
          <button id="btnSignup" class="btn secondary">Crear cuenta</button>
        </div>
        <p class="hint">Â¿Olvidaste la contraseÃ±a? <a href="#" id="btnReset">Restablecer</a></p>
        <p id="authMsg" class="muted"></p>
      </div>
    </section>

    <!-- APP -->
    <section id="app" class="hidden">
      <div class="topbar">
        <h1 class="title"><span class="logo"></span><span>ðŸ’¼ Mis Finanzas 2.0</span></h1>
        <span class="pill ok" id="userBadge">Conectado</span>
        <div class="right">
          <button id="btnSignout" class="btn danger">Cerrar sesiÃ³n</button>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <div class="card grid">
            <h3>Agregar movimiento</h3>
            <label>Fecha
              <input id="movDate" type="date" />
            </label>
            <label>Detalle
              <input id="movDesc" type="text" placeholder="Ej: Supermercado, Nafta, Sueldo..." />
            </label>
            <div class="row">
              <div class="col">
                <label>Tipo
                  <select id="movType">
                    <option value="gasto">Gasto</option>
                    <option value="ingreso">Ingreso</option>
                  </select>
                </label>
              </div>
              <div class="col">
                <label>Monto (ARS)
                  <input id="movAmount" type="number" step="0.01" inputmode="decimal" placeholder="0.00" />
                </label>
              </div>
            </div>
            <button id="btnAdd" class="btn">Guardar</button>
            <p id="formMsg" class="muted"></p>
          </div>
        </div>

        <div class="col">
          <div class="card grid">
            <h3>Resumen</h3>
            <div class="row">
              <div class="col card" style="padding:12px">
                <div class="muted">Ingresos</div>
                <div id="sumIn" style="font-weight:700;font-size:1.3rem">$0</div>
              </div>
              <div class="col card" style="padding:12px">
                <div class="muted">Gastos</div>
                <div id="sumOut" style="font-weight:700;font-size:1.3rem">$0</div>
              </div>
              <div class="col card" style="padding:12px">
                <div class="muted">Balance</div>
                <div id="sumBal" style="font-weight:700;font-size:1.3rem">$0</div>
              </div>
            </div>
            <div class="hint">Los datos se guardan en tu navegador (localStorage) por usuario.</div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:16px;">
        <div class="row" style="align-items:center">
          <h3 style="margin:0">Movimientos</h3>
          <div class="right">
            <input id="filterText" type="text" placeholder="Buscar..." />
            <button id="btnClearAll" class="btn secondary">Vaciar lista</button>
          </div>
        </div>
        <table id="tbl">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Detalle</th>
              <th>Tipo</th>
              <th>Monto</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>

      <footer>Hecho para Nadir â€¢ GitHub Pages â€¢ v1.0</footer>
    </section>
  </div>

  <!-- Firebase (v10 compat para uso simple en script inline) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <script>
    // ðŸ‘‰ Config de tu proyecto (la que pegaste)
    const firebaseConfig = {
      apiKey: "AIzaSyAoS2NRmIQ1kL97stj1x0kJfBkcby2bdkw",
      authDomain: "mis-finanzas-2.firebaseapp.com",
      projectId: "mis-finanzas-2",
      storageBucket: "mis-finanzas-2.firebasestorage.app",
      messagingSenderId: "178519871416",
      appId: "1:178519871416:web:f49bc2c66d61e6ae15094d",
      measurementId: "G-WPRBW17E97"
    };

    // Init Firebase
    const appFB = firebase.initializeApp(firebaseConfig);
    if (typeof firebase.analytics === 'function') try { firebase.analytics(); } catch(e){}

    const auth = firebase.auth();

    // UI helpers
    const $ = s => document.querySelector(s);
    const show = (id, visible) => {
      const el = $(id);
      if(!el) return;
      el.classList.toggle('hidden', !visible);
    };
    const fmt = n => new Intl.NumberFormat('es-AR', { style:'currency', currency:'ARS' }).format(Number(n||0));

    // ---------- AUTH ----------
    const authMsg = $('#authMsg');
    $('#btnLogin').addEventListener('click', async () => {
      authMsg.textContent = '';
      const email = $('#email').value.trim();
      const pass  = $('#password').value;
      try{
        await auth.signInWithEmailAndPassword(email, pass);
      }catch(err){ authMsg.textContent = 'Error al iniciar sesiÃ³n: ' + (err.message || err.code); }
    });

    $('#btnSignup').addEventListener('click', async () => {
      authMsg.textContent = '';
      const email = $('#email').value.trim();
      const pass  = $('#password').value;
      try{
        await auth.createUserWithEmailAndPassword(email, pass);
        authMsg.textContent = 'Cuenta creada. Ya podÃ©s ingresar.';
      }catch(err){ authMsg.textContent = 'No se pudo crear la cuenta: ' + (err.message || err.code); }
    });

    $('#btnReset').addEventListener('click', async (e) => {
      e.preventDefault();
      const email = $('#email').value.trim();
      if(!email){ authMsg.textContent = 'IngresÃ¡ tu email para enviarte el enlace.'; return; }
      try{
        await auth.sendPasswordResetEmail(email);
        authMsg.textContent = 'Te enviamos un email para restablecer tu contraseÃ±a.';
      }catch(err){ authMsg.textContent = 'No se pudo enviar: ' + (err.message || err.code); }
    });

    $('#btnSignout').addEventListener('click', () => auth.signOut());

    auth.onAuthStateChanged(user => {
      if(user){
        $('#userBadge').textContent = user.email;
        show('#auth', false);
        show('#app', true);
        loadData(user.uid);
      }else{
        show('#app', false);
        show('#auth', true);
      }
    });

    // ---------- DATA (localStorage por usuario) ----------
    const keyFor = uid => `mf2.movs.${uid}`;
    let MOVS = []; // {id, date, desc, type, amount}

    function save(uid){
      localStorage.setItem(keyFor(uid), JSON.stringify(MOVS));
      render();
    }
    function loadData(uid){
      let raw = localStorage.getItem(keyFor(uid));
      MOVS = Array.isArray(JSON.parse(raw || '[]')) ? JSON.parse(raw || '[]') : [];
      render();
    }
    function addMov(obj){
      MOVS.unshift({ id: crypto.randomUUID(), ...obj });
      save(auth.currentUser.uid);
      $('#movDesc').value='';
      $('#movAmount').value='';
    }
    function removeMov(id){
      MOVS = MOVS.filter(m => m.id !== id);
      save(auth.currentUser.uid);
    }
    function clearAll(){
      if(!confirm('Â¿Vaciar todos los movimientos?')) return;
      MOVS = [];
      save(auth.currentUser.uid);
    }
    function render(){
      // filtro
      const q = ($('#filterText').value || '').toLowerCase();
      const data = !q ? MOVS : MOVS.filter(m => 
        m.desc.toLowerCase().includes(q) || m.type.toLowerCase().includes(q)
      );
      // tabla
      const tbody = $('#rows');
      tbody.innerHTML = data.map(m => `
        <tr>
          <td>${m.date || ''}</td>
          <td>${m.desc || ''}</td>
          <td><span class="pill ${m.type==='ingreso'?'ok':'bad'}">${m.type}</span></td>
          <td>${fmt(m.amount)}</td>
          <td><button data-id="${m.id}" class="btn secondary btn-del">Eliminar</button></td>
        </tr>
      `).join('');

      // resumen
      const sumIn  = data.filter(x=>x.type==='ingreso').reduce((a,b)=>a+Number(b.amount||0),0);
      const sumOut = data.filter(x=>x.type==='gasto').reduce((a,b)=>a+Number(b.amount||0),0);
      $('#sumIn').textContent  = fmt(sumIn);
      $('#sumOut').textContent = fmt(sumOut);
      $('#sumBal').textContent = fmt(sumIn - sumOut);

      // eventos eliminar
      document.querySelectorAll('.btn-del').forEach(btn=>{
        btn.onclick = () => removeMov(btn.getAttribute('data-id'));
      });
    }

    // eventos UI
    $('#btnAdd').addEventListener('click', () => {
      const date = $('#movDate').value || new Date().toISOString().slice(0,10);
      const desc = ($('#movDesc').value || '').trim();
      const type = $('#movType').value;
      const amount = parseFloat($('#movAmount').value || '0');
      const msg = $('#formMsg');
      msg.textContent = '';
      if(!desc || !amount){ msg.textContent = 'CompletÃ¡ detalle y monto.'; return; }
      addMov({ date, desc, type, amount });
      msg.textContent = 'Guardado âœ”';
      setTimeout(()=> msg.textContent = '', 1500);
    });
    $('#btnClearAll').addEventListener('click', clearAll);
    $('#filterText').addEventListener('input', render);
  </script>
</body>
</html>
